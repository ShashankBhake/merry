
upstream bitcoin_servers {
    server bitcoin:18443;
    server bitcoin:18444;
    server bitcoin:28332;
    server bitcoin:28333;
}
upstream arbitrum_servers {
    server arbitrum:8545;
}
upstream arbitrum_explorer_servers {
    server arbitrum-explorer:80;
}
upstream ethereum_servers {
    server ethereum:8545;
}
upstream ethereum_explorer_servers {
    server ethereum-explorer:80;
}
upstream electrs_servers {
    server electrs:50000;
    server electrs:30000;
}
upstream esplora_servers {
    server esplora:5000;
}
upstream chopsticks_servers {
    server chopsticks:3000;
}
upstream postgres_servers {
    server postgres:5432;
}
upstream redis_servers {
    server redis:6379;
}
upstream orderbook_servers {
    server orderbook:8080;
}

server {
    listen 80;

    location /bitcoin {
        proxy_pass http://bitcoin_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /arbitrum {
        proxy_pass http://arbitrum_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /arbitrum-explorer {
        proxy_pass http://arbitrum_explorer_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /ethereum {
        proxy_pass http://ethereum_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /ethereum-explorer {
        proxy_pass http://ethereum_explorer_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /electrs {
        proxy_pass http://electrs_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /esplora {
        proxy_pass http://esplora:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /chopsticks {
        proxy_pass http://chopsticks_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /orderbook {
        proxy_pass http://orderbook_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /cobi {
        proxy_pass http://cobi:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
